# Первые шаги

В этом цикле статей, вы научитесь **базовым вещам** в **Nest**. Чтобы познакомиться с основными кирпичиками, на которых
строятся приложения **Nest**, мы сделаем базовое **CRUD** приложение, постаравшись при этом охватить довольно большой
список вопросов на начальном уровне.

## Язык программирования

Мы обожаем [TypeScript](https://www.typescriptlang.org/), но прежде всего, мы любим [Node.js](https://nodejs.org/ru/).
Именно поэтому **Nest** совместим как с **TypeScript**, так и c чистым **JavaScript**. **Nest** использует преимущества
последних версий языка, поэтому, чтобы использовать его с ванильным JavaScript, нам необходим
компилятор [Babel](https://babeljs.io/).

В основном, в наших примерах будет использоваться **TypeScript**, но вы всегда сможете переключить их на **JavaScript**.

## Подготовка

Перед тем как начать, пожалуйста, удостоверьтесь, что на вашем компьютере установлена [Node.js](https://nodejs.org/ru/)
выше 12-ой версии (кроме Node v13).

## Настройка

Настройка нового проекта крайне проста при использовании с **Nest CLI**. С установленным [npm](https://www.npmjs.com/)
вы можете создать новый **Nest** проект просто выполнив следующие команды в терминале вашей операционной системы:

```shell
$ npm i -g @nestjs/cli
$ nest new project-name
```

> [!NOTE]
> Чтобы создать новый проект с включённым строгим режимом для __TypeScript__ ([strict mode](https://www.typescriptlang.org/tsconfig#strict)), передайте флаг `--strict` в команду `nest new`.

Будет создана директория с именем `project-name`, в которой будут находиться установленные пакеты и ещё несколько
стандартных файлов, а также папка `src/`, в которую будут помещены несколько основных файлов.

```
src/
├── app.controller.spec.ts
├── app.controller.ts
├── app.service.ts
├── app.module.ts
└── main.ts
```

Вот небольшое описание предназначения для каждого из них:

[//]: # (@formatter:off)
| Имя файла                | Описание                                                                                               |
|--------------------------|--------------------------------------------------------------------------------------------------------|
| `app.controller.ts`      | Базовый контроллер с одним роутом.                                                                     |
| `app.controller.spec.ts` | Unit тесты для этого контроллера                                                                       |
| `app.module.ts`          | Корневой модуль приложения                                                                             |
| `app.service.ts`         | Базовый сервис с одним методом                                                                         |
| `main.ts`                | Входной файл приложения который использует `NestFactory` для того чтобы создать экземпляр приложения   |

[//]: # (@formatter:on)

`main.ts` содержит в себе асинхронную функцию, которая запускает наше приложение:

<!-- tabs:start -->

#### **TypeScript**

```typescript
/* main.ts */

import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    await app.listen(3000);
}

bootstrap();
```

#### **JavaScript**

```js
/* main.js */

import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';

async function bootstrap() {
    const app = await NestFactory.create(AppModule);
    await app.listen(3000);
}

bootstrap();
```

<!-- tabs:end -->

Чтобы создать экземпляр **Nest** приложения, мы используем класс `NestFactory` класс. `NestFactory` предоставляет нам
несколько статических методов, позволяющих нам создать экземпляр приложения. Метод `create()` возвращает объект
приложения, который реализует интерфейс `INestApplication`. Этот объект даёт нам набор методов, которые будут описаны в
следующих главах. В примере с `main.ts` мы просто запускаем наш слушатель **HTTP** запросов, который позволяет нашему
приложению ожидать входящие запросы.

Стоит заметить, что проект, созданный при помощи **NestJS CLI** использует изначальную структуру проекта, которая
побуждает разработчиков следовать соглашению о хранении каждого модуля в своей собственной директории.

> [!NOTE]
> По умолчанию, если происходит какая-либо ошибка при создании приложения, ваше приложение будет остановлено с кодом `1`. Если вы хотите, чтобы вместо этого выбрасывалась ошибка, присвойте значение `false` параметру `abortOnError` таким образом: `NestFactory.create(AppModule, { abortOnError: false })`

## Платформа

**Nest** стремится быть независимым от платформы фреймворком. Независимость от платформы позволяет создавать
переиспользуемые части кода, которые разработчики могут использовать в различных типах приложений. Технически, **Nest**
может работать с любым **HTTP** фреймворком после того как для него создан адаптер. Всего есть две таких платформы,
которые поставляются сразу из коробки: [Express](https://expressjs.com/) и [Fastify](https://www.fastify.io/). Вы можете
выбрать любой подходящий для вас.

[//]: # (@formatter:off)
| Платформа          | Описание                                                                                                                                                                                                                                                                                         |
|--------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `platform-express` | [Express](https://expressjs.com/) — широко известный минималистичный фреймворк для **node**. Это проверенная в бою, полностью готовая к production среде библиотека с огромным количеством инструментов, созданных сообществом. `@nestjs/platform-express` используется в **Nest** по умолчанию. |
| `platform-fastify` | [Fastify](https://www.fastify.io/) — высокопроизводительный фреймворк, нацеленный на предоставление максимальной эффективности и скорости.                                                                                                                                                       |

[//]: # (@formatter:on)

Какая бы платформа ни использовалась, она предоставляет свой интерфейс приложения. В данном случае
это `NestExpressApplication` и `NestFastifyApplication` соответственно.

Когда вы передаёте тип в `NestFactory.create()`, как в примере снизу, объект приложения будет иметь методы, доступные
исключительно для указанной платформы. Обратите внимание, что **вам не нужно** передавать тип **до тех пор**, пока вам
действительно не понадобится доступ к API базовой платформы.

```typescript
const app = await NestFactory.create<NestExpressApplication>(AppModule);
```

## Запуск приложения

После того как процесс установки завершён, вы можете запустить данную команду в вашем терминале, чтобы запустить
приложение, слушающее входящие запросы:

```shell
$ npm run start
```

Эта команда запустит ваш **HTTP** сервер, который будет слушать запросы на порту, что был определён в `src/main.ts`.
После запуска приложения откройте ваш браузер и перейдите по адресу `http://localhost:3000/`. Вы будете должны такое
сообщение: `Hello World!`.

Чтобы отслеживать изменения в файлах, вы можете использовать эту команду для запуска приложения:

```shell
$ npm run start:dev
```

Она будет следить за изменениями в ваших файлах и автоматически пересобирать и перезапускать сервер.
